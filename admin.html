<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartPolice - 警備契約管理システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .notification-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    </style>
</head>
<body class="bg-gray-50" x-data="smartPoliceSystem()">
    <!-- ログイン画面 -->
    <div x-show="!isLoggedIn" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-900 to-blue-700">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <i class="fas fa-shield-alt text-4xl text-blue-600 mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">SmartPolice</h1>
                <p class="text-gray-600">警備契約管理システム</p>
            </div>
            
            <form @submit.prevent="login">
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">
                        <i class="fas fa-user mr-2"></i>ユーザーID
                    </label>
                    <input type="text" x-model="credentials.username" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="ユーザーIDを入力" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">
                        <i class="fas fa-lock mr-2"></i>パスワード
                    </label>
                    <input type="password" x-model="credentials.password" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="パスワードを入力" required>
                </div>
                <button type="submit" 
                        class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                    <i class="fas fa-sign-in-alt mr-2"></i>ログイン
                </button>
            </form>
            
            <div class="mt-6 text-sm text-gray-600">
                <p class="font-medium mb-2">テスト用アカウント:</p>
                <div class="space-y-1 text-xs">
                    <p><span class="font-medium">管理者:</span> admin / admin123</p>
                    <p><span class="font-medium">担当者:</span> officer / officer123</p>
                    <p><span class="font-medium">顧客:</span> client / client123</p>
                </div>
            </div>
        </div>
    </div>

    <!-- メインシステム -->
    <div x-show="isLoggedIn" class="min-h-screen bg-gray-50">
        <!-- ヘッダー -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-2xl text-blue-600 mr-3"></i>
                        <h1 class="text-2xl font-bold text-gray-800">SmartPolice</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- 通知ベル -->
                        <div class="relative" x-data="{ showNotifications: false }">
                            <button @click="showNotifications = !showNotifications" 
                                    class="relative p-2 text-gray-500 hover:text-gray-700 transition-colors">
                                <i class="fas fa-bell text-xl"></i>
                                <span x-show="notifications.filter(n => !n.read).length > 0" 
                                      class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge"
                                      x-text="notifications.filter(n => !n.read).length"></span>
                            </button>
                            
                            <!-- 通知ドロップダウン -->
                            <div x-show="showNotifications" @click.away="showNotifications = false"
                                 class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border z-50 fade-in">
                                <div class="p-4 border-b">
                                    <div class="flex justify-between items-center">
                                        <h3 class="font-medium text-gray-800">通知</h3>
                                        <button @click="markAllAsRead()" class="text-sm text-blue-600 hover:text-blue-800">
                                            すべて既読にする
                                        </button>
                                    </div>
                                </div>
                                <div class="max-h-64 overflow-y-auto">
                                    <template x-for="notification in notifications.slice(0, 5)" :key="notification.id">
                                        <div @click="markAsRead(notification.id)" 
                                             class="p-3 border-b hover:bg-gray-50 cursor-pointer"
                                             :class="{ 'bg-blue-50': !notification.read }">
                                            <div class="flex items-start">
                                                <i :class="notification.icon" class="mt-1 mr-2 text-sm"></i>
                                                <div class="flex-1">
                                                    <p class="text-sm font-medium text-gray-800" x-text="notification.title"></p>
                                                    <p class="text-xs text-gray-600 mt-1" x-text="notification.message"></p>
                                                    <p class="text-xs text-gray-400 mt-1" x-text="notification.time"></p>
                                                </div>
                                                <div x-show="!notification.read" class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600" x-text="`${currentUser.name} (${currentUser.role})`"></span>
                            <button @click="logout" class="text-sm text-red-600 hover:text-red-800">
                                <i class="fas fa-sign-out-alt mr-1"></i>ログアウト
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- サイドバー -->
            <aside class="w-64 bg-white shadow-sm min-h-screen">
                <nav class="mt-5 px-2">
                    <template x-for="item in menuItems" :key="item.id">
                        <div x-show="hasPermission(item.permission)">
                            <button @click="currentView = item.id" 
                                    class="group flex items-center px-2 py-2 text-base font-medium rounded-md w-full text-left mb-1 transition-colors"
                                    :class="currentView === item.id ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-50'">
                                <i :class="item.icon" class="mr-3 flex-shrink-0 h-6 w-6"></i>
                                <span x-text="item.name"></span>
                            </button>
                        </div>
                    </template>
                </nav>
            </aside>

            <!-- メインコンテンツ -->
            <main class="flex-1 p-6">
                <!-- ダッシュボード -->
                <div x-show="currentView === 'dashboard'" class="fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">ダッシュボード</h2>
                        <p class="text-gray-600">システム概要と最新情報</p>
                    </div>

                    <!-- KPI カード -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-users text-3xl text-blue-500"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">総契約者数</dt>
                                        <dd class="text-2xl font-bold text-gray-900" x-text="clients.length"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-shield-alt text-3xl text-green-500"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">有効契約</dt>
                                        <dd class="text-2xl font-bold text-gray-900" x-text="clients.filter(c => c.status === '有効').length"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-yen-sign text-3xl text-yellow-500"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">月額売上</dt>
                                        <dd class="text-2xl font-bold text-gray-900">¥2,850,000</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-exclamation-triangle text-3xl text-red-500"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">要注意案件</dt>
                                        <dd class="text-2xl font-bold text-gray-900">3</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- チャートエリア -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <!-- 月別売上推移 -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">月別売上推移</h3>
                            <canvas id="revenueChart" width="400" height="300"></canvas>
                        </div>

                        <!-- プラン別契約分布 -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">プラン別契約分布</h3>
                            <canvas id="planChart" width="400" height="300"></canvas>
                        </div>
                    </div>

                    <!-- 地域・業界分析 -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- 地域別契約者分布 -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">地域別契約者分布</h3>
                            <div class="space-y-3">
                                <template x-for="(count, region) in regionStats" :key="region">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-700" x-text="region"></span>
                                        <div class="flex items-center">
                                            <div class="w-32 bg-gray-200 rounded-full h-2 mr-3">
                                                <div class="bg-blue-500 h-2 rounded-full" :style="`width: ${(count / Math.max(...Object.values(regionStats))) * 100}%`"></div>
                                            </div>
                                            <span class="text-sm text-gray-600" x-text="count + '件'"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- 業界別契約分布 -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">業界別契約分布</h3>
                            <div class="space-y-3">
                                <template x-for="(count, industry) in industryStats" :key="industry">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-700" x-text="industry"></span>
                                        <div class="flex items-center">
                                            <div class="w-32 bg-gray-200 rounded-full h-2 mr-3">
                                                <div class="bg-green-500 h-2 rounded-full" :style="`width: ${(count / Math.max(...Object.values(industryStats))) * 100}%`"></div>
                                            </div>
                                            <span class="text-sm text-gray-600" x-text="count + '件'"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 契約者管理 -->
                <div x-show="currentView === 'clients'" class="fade-in">
                    <div class="mb-6 flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">契約者管理</h2>
                            <p class="text-gray-600">契約者情報の登録・編集・管理</p>
                        </div>
                        <div class="space-x-2">
                            <button @click="exportCSV('clients')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                <i class="fas fa-download mr-2"></i>CSVエクスポート
                            </button>
                            <button @click="showImportModal = true" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-upload mr-2"></i>CSVインポート
                            </button>
                            <button @click="openClientForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>新規登録
                            </button>
                        </div>
                    </div>

                    <!-- 検索・フィルター -->
                    <div class="bg-white rounded-lg shadow mb-6 p-4">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input type="text" x-model="searchQuery" placeholder="契約者名・会社名で検索" 
                                   class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <select x-model="filterStatus" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">全ステータス</option>
                                <option value="有効">有効</option>
                                <option value="保留">保留</option>
                                <option value="無効">無効</option>
                            </select>
                            <select x-model="filterPlan" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">全プラン</option>
                                <option value="ベーシック">ベーシック</option>
                                <option value="スタンダード">スタンダード</option>
                                <option value="プレミアム">プレミアム</option>
                            </select>
                            <button @click="clearFilters()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-200">
                                <i class="fas fa-times mr-2"></i>クリア
                            </button>
                        </div>
                    </div>

                    <!-- データテーブル -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">契約者情報</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">連絡先</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">プラン</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ステータス</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="client in paginatedClients" :key="client.id">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900" x-text="client.name"></div>
                                                <div class="text-sm text-gray-500" x-text="client.company"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="client.phone"></div>
                                                <div class="text-sm text-gray-500" x-text="client.email"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" x-text="client.plan"></div>
                                                <div class="text-sm text-gray-500" x-text="'¥' + client.monthlyFee?.toLocaleString()"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                      :class="{
                                                          'bg-green-100 text-green-800': client.status === '有効',
                                                          'bg-yellow-100 text-yellow-800': client.status === '保留',
                                                          'bg-red-100 text-red-800': client.status === '無効'
                                                      }"
                                                      x-text="client.status">
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button @click="openClientForm(client)" class="text-blue-600 hover:text-blue-900">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button @click="deleteClient(client.id)" class="text-red-600 hover:text-red-900">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                                <button @click="printClient(client)" class="text-green-600 hover:text-green-900">
                                                    <i class="fas fa-print"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- ページネーション -->
                        <div class="bg-white px-4 py-3 border-t border-gray-200 sm:px-6">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-gray-700">
                                    <span x-text="`${(currentPage - 1) * itemsPerPage + 1} - ${Math.min(currentPage * itemsPerPage, filteredClients.length)} 件 (全 ${filteredClients.length} 件)`"></span>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="currentPage > 1 && currentPage--" :disabled="currentPage <= 1"
                                            class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50">
                                        前へ
                                    </button>
                                    <button @click="currentPage < totalPages && currentPage++" :disabled="currentPage >= totalPages"
                                            class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50">
                                        次へ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ユーザー管理 -->
                <div x-show="currentView === 'users'" class="fade-in">
                    <div class="mb-6 flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">ユーザー管理</h2>
                            <p class="text-gray-600">システムユーザーの管理・権限設定</p>
                        </div>
                        <button @click="openUserForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-user-plus mr-2"></i>新規ユーザー追加
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ユーザー</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">権限</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最終ログイン</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ステータス</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="user in users" :key="user.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <i class="fas fa-user-circle text-2xl text-gray-400 mr-3"></i>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900" x-text="user.name"></div>
                                                    <div class="text-sm text-gray-500" x-text="user.username"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="user.role"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="user.lastLogin"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                  :class="user.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                  x-text="user.active ? '有効' : '無効'">
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button @click="openUserForm(user)" class="text-blue-600 hover:text-blue-900">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="toggleUserStatus(user.id)" 
                                                    :class="user.active ? 'text-red-600 hover:text-red-900' : 'text-green-600 hover:text-green-900'">
                                                <i :class="user.active ? 'fas fa-user-slash' : 'fas fa-user-check'"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 監査ログ -->
                <div x-show="currentView === 'audit'" class="fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">監査ログ</h2>
                        <p class="text-gray-600">システムの操作履歴とセキュリティログ</p>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">日時</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ユーザー</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">対象</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">結果</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="log in auditLogs" :key="log.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="log.timestamp"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="log.user"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="log.action"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="log.target"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                  :class="log.result === '成功' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                  x-text="log.result">
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- その他のビュー（レポート、設定等）のプレースホルダー -->
                <div x-show="currentView === 'reports'" class="fade-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">レポート管理</h2>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-gray-600 mb-4">各種レポートの生成・管理機能</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-chart-bar text-2xl mb-2"></i>
                                <div class="font-medium">月次売上レポート</div>
                            </button>
                            <button class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition duration-200">
                                <i class="fas fa-users text-2xl mb-2"></i>
                                <div class="font-medium">契約者リスト</div>
                            </button>
                            <button class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition duration-200">
                                <i class="fas fa-file-alt text-2xl mb-2"></i>
                                <div class="font-medium">監査レポート</div>
                            </button>
                        </div>
                    </div>
                </div>

                <div x-show="currentView === 'settings'" class="fade-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">システム設定</h2>
                    <div class="bg-white rounded-lg shadow p-6">
                        <p class="text-gray-600">システム全体の設定管理</p>
                        <div class="mt-6 space-y-4">
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div>
                                    <h3 class="font-medium">メール通知</h3>
                                    <p class="text-sm text-gray-600">新規契約時の自動メール送信</p>
                                </div>
                                <input type="checkbox" checked class="form-checkbox h-5 w-5 text-blue-600">
                            </div>
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div>
                                    <h3 class="font-medium">自動バックアップ</h3>
                                    <p class="text-sm text-gray-600">毎日午前2時にデータバックアップ</p>
                                </div>
                                <input type="checkbox" checked class="form-checkbox h-5 w-5 text-blue-600">
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- 契約者フォームモーダル -->
        <div x-show="showClientForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl m-4 max-h-screen overflow-y-auto">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold" x-text="editingClient ? '契約者情報編集' : '新規契約者登録'"></h3>
                </div>
                <form @submit.prevent="saveClient" class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">契約者名 *</label>
                            <input type="text" x-model="clientForm.name" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">会社名</label>
                            <input type="text" x-model="clientForm.company"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">電話番号 *</label>
                            <input type="tel" x-model="clientForm.phone" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">メールアドレス *</label>
                            <input type="email" x-model="clientForm.email" required
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">住所</label>
                            <input type="text" x-model="clientForm.address"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">プラン *</label>
                            <select x-model="clientForm.plan" required
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">選択してください</option>
                                <option value="ベーシック">ベーシック</option>
                                <option value="スタンダード">スタンダード</option>
                                <option value="プレミアム">プレミアム</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">月額料金</label>
                            <input type="number" x-model="clientForm.monthlyFee"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ステータス</label>
                            <select x-model="clientForm.status"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="有効">有効</option>
                                <option value="保留">保留</option>
                                <option value="無効">無効</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">備考</label>
                        <textarea x-model="clientForm.notes" rows="3"
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2 pt-4">
                        <button type="button" @click="closeClientForm()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            キャンセル
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <span x-text="editingClient ? '更新' : '登録'"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- CSVインポートモーダル -->
        <div x-show="showImportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg m-4">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-semibold">CSVインポート</h3>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">CSVファイルを選択</label>
                        <input type="file" accept=".csv" @change="handleFileSelect"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2">
                    </div>
                    <div class="text-sm text-gray-600 mb-4">
                        <p class="font-medium mb-2">CSVフォーマット:</p>
                        <p class="font-mono text-xs bg-gray-100 p-2 rounded">
                            name,company,phone,email,address,plan,monthlyFee,status,notes
                        </p>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button @click="showImportModal = false" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            キャンセル
                        </button>
                        <button @click="importCSV()" :disabled="!csvFile"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
                            インポート
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function smartPoliceSystem() {
            return {
                // 認証状態
                isLoggedIn: false,
                credentials: { username: '', password: '' },
                currentUser: { name: '', role: '', permissions: [] },
                
                // UI状態
                currentView: 'dashboard',
                showClientForm: false,
                showImportModal: false,
                editingClient: null,
                csvFile: null,
                
                // 検索・フィルター
                searchQuery: '',
                filterStatus: '',
                filterPlan: '',
                
                // ページネーション
                currentPage: 1,
                itemsPerPage: 10,

                // 統計データ
                stats: {
                    totalClients: 0,
                    activeContracts: 0,
                    monthlyRevenue: 2850000,
                    alertCases: 3
                },

                regionStats: {
                    '東京都': 45,
                    '神奈川県': 32,
                    '大阪府': 28,
                    '愛知県': 22,
                    'その他': 18
                },

                industryStats: {
                    '製造業': 38,
                    '小売業': 29,
                    'サービス業': 24,
                    'IT関連': 19,
                    'その他': 15
                },

                // 通知データ
                notifications: [
                    {
                        id: 1,
                        title: '新規契約申込',
                        message: '株式会社サンプルから警備契約の申込がありました',
                        time: '5分前',
                        icon: 'fas fa-user-plus text-blue-500',
                        read: false
                    },
                    {
                        id: 2,
                        title: 'システムメンテナンス',
                        message: '明日午前2時〜4時にシステムメンテナンスを実施します',
                        time: '1時間前',
                        icon: 'fas fa-tools text-yellow-500',
                        read: false
                    },
                    {
                        id: 3,
                        title: '契約更新確認',
                        message: '田中商事の契約が来月末で期限切れになります',
                        time: '3時間前',
                        icon: 'fas fa-exclamation-triangle text-red-500',
                        read: true
                    }
                ],
                
                // フォームデータ
                clientForm: {
                    name: '', company: '', phone: '', email: '', address: '',
                    plan: '', monthlyFee: '', status: '有効', notes: ''
                },
                
                // データ
                clients: [
                    {
                        id: 1, name: '田中太郎', company: '田中商事', phone: '03-1234-5678',
                        email: 'tanaka@example.com', address: '東京都渋谷区1-2-3',
                        plan: 'ベーシック', monthlyFee: 50000, status: '有効', notes: ''
                    },
                    {
                        id: 2, name: '佐藤花子', company: 'サトウ株式会社', phone: '06-9876-5432',
                        email: 'sato@example.com', address: '大阪府大阪市中央区4-5-6',
                        plan: 'プレミアム', monthlyFee: 120000, status: '有効', notes: 'VIP顧客'
                    },
                    {
                        id: 3, name: '鈴木一郎', company: '鈴木工業', phone: '052-1111-2222',
                        email: 'suzuki@example.com', address: '愛知県名古屋市中区7-8-9',
                        plan: 'スタンダード', monthlyFee: 80000, status: '保留', notes: '契約検討中'
                    }
                ],
                
                users: [
                    { id: 1, username: 'admin', name: '管理者', role: 'SuperAdmin', active: true, lastLogin: '2024-01-15 09:30' },
                    { id: 2, username: 'officer', name: '田中担当者', role: 'Officer', active: true, lastLogin: '2024-01-15 08:45' },
                    { id: 3, username: 'client', name: '佐藤顧客', role: 'ClientUser', active: true, lastLogin: '2024-01-14 16:20' }
                ],
                
                auditLogs: [
                    { id: 1, timestamp: '2024-01-15 10:15:32', user: '管理者', action: '契約者追加', target: '田中太郎', result: '成功' },
                    { id: 2, timestamp: '2024-01-15 09:30:15', user: '田中担当者', action: 'ログイン', target: 'システム', result: '成功' },
                    { id: 3, timestamp: '2024-01-15 08:45:22', user: '佐藤顧客', action: '契約情報確認', target: '自社契約', result: '成功' }
                ],
                
                // 権限定義
                rolePermissions: {
                    SuperAdmin: ['all'],
                    Admin: ['dashboard', 'clients', 'users', 'reports', 'settings', 'audit'],
                    Officer: ['dashboard', 'clients', 'reports'],
                    Advisor: ['dashboard', 'clients'],
                    Clerk: ['dashboard', 'clients'],
                    ClientAdmin: ['dashboard', 'client-view'],
                    ClientUser: ['dashboard', 'client-view'],
                    Auditor: ['dashboard', 'audit', 'reports']
                },
                
                menuItems: [
                    { id: 'dashboard', name: 'ダッシュボード', icon: 'fas fa-tachometer-alt', permission: 'dashboard' },
                    { id: 'clients', name: '契約者管理', icon: 'fas fa-users', permission: 'clients' },
                    { id: 'users', name: 'ユーザー管理', icon: 'fas fa-user-cog', permission: 'users' },
                    { id: 'reports', name: 'レポート', icon: 'fas fa-chart-bar', permission: 'reports' },
                    { id: 'audit', name: '監査ログ', icon: 'fas fa-clipboard-list', permission: 'audit' },
                    { id: 'settings', name: 'システム設定', icon: 'fas fa-cog', permission: 'settings' }
                ],

                // 初期化
                init() {
                    // チャートの初期化は認証後に実行
                    this.$watch('isLoggedIn', (value) => {
                        if (value) {
                            this.$nextTick(() => {
                                this.initializeCharts();
                            });
                        }
                    });
                },

                // チャート初期化
                initializeCharts() {
                    // 月別売上推移チャート
                    const revenueCtx = document.getElementById('revenueChart');
                    if (revenueCtx) {
                        new Chart(revenueCtx, {
                            type: 'line',
                            data: {
                                labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                                datasets: [{
                                    label: '売上 (万円)',
                                    data: [220, 250, 285, 310, 280, 285],
                                    borderColor: 'rgb(59, 130, 246)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }

                    // プラン別契約分布チャート
                    const planCtx = document.getElementById('planChart');
                    if (planCtx) {
                        new Chart(planCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['ベーシック', 'スタンダード', 'プレミアム'],
                                datasets: [{
                                    data: [45, 35, 20],
                                    backgroundColor: [
                                        'rgb(34, 197, 94)',
                                        'rgb(59, 130, 246)',
                                        'rgb(168, 85, 247)'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom'
                                    }
                                }
                            }
                        });
                    }
                },

                // 通知関連メソッド
                markAsRead(notificationId) {
                    const notification = this.notifications.find(n => n.id === notificationId);
                    if (notification) {
                        notification.read = true;
                    }
                },

                markAllAsRead() {
                    this.notifications.forEach(n => n.read = true);
                },
                
                // 認証
                login() {
                    const users = {
                        'admin': { password: 'admin123', name: '管理者', role: 'SuperAdmin' },
                        'officer': { password: 'officer123', name: '田中担当者', role: 'Officer' },
                        'client': { password: 'client123', name: '佐藤顧客', role: 'ClientUser' }
                    };
                    
                    const user = users[this.credentials.username];
                    if (user && user.password === this.credentials.password) {
                        this.currentUser = {
                            name: user.name,
                            role: user.role,
                            permissions: this.rolePermissions[user.role]
                        };
                        this.isLoggedIn = true;
                        this.addAuditLog('ログイン', 'システム', '成功');
                    } else {
                        alert('ユーザーIDまたはパスワードが間違っています');
                    }
                },
                
                logout() {
                    this.addAuditLog('ログアウト', 'システム', '成功');
                    this.isLoggedIn = false;
                    this.credentials = { username: '', password: '' };
                    this.currentUser = { name: '', role: '', permissions: [] };
                    this.currentView = 'dashboard';
                },
                
                // 権限チェック
                hasPermission(permission) {
                    return this.currentUser.permissions.includes('all') || 
                           this.currentUser.permissions.includes(permission);
                },
                
                // 契約者管理
                get filteredClients() {
                    return this.clients.filter(client => {
                        const matchesSearch = !this.searchQuery || 
                            client.name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                            client.company.toLowerCase().includes(this.searchQuery.toLowerCase());
                        const matchesStatus = !this.filterStatus || client.status === this.filterStatus;
                        const matchesPlan = !this.filterPlan || client.plan === this.filterPlan;
                        return matchesSearch && matchesStatus && matchesPlan;
                    });
                },
                
                get paginatedClients() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    return this.filteredClients.slice(start, start + this.itemsPerPage);
                },
                
                get totalPages() {
                    return Math.ceil(this.filteredClients.length / this.itemsPerPage);
                },
                
                openClientForm(client = null) {
                    this.editingClient = client;
                    if (client) {
                        this.clientForm = { ...client };
                    } else {
                        this.clientForm = {
                            name: '', company: '', phone: '', email: '', address: '',
                            plan: '', monthlyFee: '', status: '有効', notes: ''
                        };
                    }
                    this.showClientForm = true;
                },
                
                closeClientForm() {
                    this.showClientForm = false;
                    this.editingClient = null;
                },
                
                saveClient() {
                    if (this.editingClient) {
                        const index = this.clients.findIndex(c => c.id === this.editingClient.id);
                        this.clients[index] = { ...this.clientForm, id: this.editingClient.id };
                        this.addAuditLog('契約者更新', this.clientForm.name, '成功');
                    } else {
                        const newId = Math.max(...this.clients.map(c => c.id)) + 1;
                        this.clients.push({ ...this.clientForm, id: newId });
                        this.addAuditLog('契約者追加', this.clientForm.name, '成功');
                    }
                    this.closeClientForm();
                },
                
                deleteClient(clientId) {
                    if (confirm('本当に削除しますか？')) {
                        const client = this.clients.find(c => c.id === clientId);
                        this.clients = this.clients.filter(c => c.id !== clientId);
                        this.addAuditLog('契約者削除', client.name, '成功');
                    }
                },
                
                printClient(client) {
                    window.print();
                    this.addAuditLog('契約者印刷', client.name, '成功');
                },
                
                clearFilters() {
                    this.searchQuery = '';
                    this.filterStatus = '';
                    this.filterPlan = '';
                    this.currentPage = 1;
                },
                
                // CSV機能
                exportCSV(type) {
                    let data, filename;
                    if (type === 'clients') {
                        data = this.clients;
                        filename = 'clients.csv';
                    }
                    
                    const headers = Object.keys(data[0]).join(',');
                    const rows = data.map(item => Object.values(item).join(','));
                    const csv = [headers, ...rows].join('\n');
                    
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.click();
                    
                    this.addAuditLog('CSVエクスポート', filename, '成功');
                },
                
                handleFileSelect(event) {
                    this.csvFile = event.target.files[0];
                },
                
                importCSV() {
                    if (!this.csvFile) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',');
                        
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim()) {
                                const values = lines[i].split(',');
                                const client = {};
                                headers.forEach((header, index) => {
                                    client[header.trim()] = values[index]?.trim();
                                });
                                client.id = Math.max(...this.clients.map(c => c.id)) + 1;
                                this.clients.push(client);
                            }
                        }
                    };
                    reader.readAsText(this.csvFile);
                    this.showImportModal = false;
                    this.addAuditLog('CSVインポート', this.csvFile.name, '成功');
                },
                
                // ユーザー管理
                openUserForm(user = null) {
                    // ユーザー管理フォームの実装
                },
                
                toggleUserStatus(userId) {
                    const user = this.users.find(u => u.id === userId);
                    if (user) {
                        user.active = !user.active;
                        this.addAuditLog('ユーザー状態変更', user.name, '成功');
                    }
                },
                
                // 監査ログ
                addAuditLog(action, target, result) {
                    const log = {
                        id: this.auditLogs.length + 1,
                        timestamp: new Date().toLocaleString('ja-JP'),
                        user: this.currentUser.name,
                        action,
                        target,
                        result
                    };
                    this.auditLogs.unshift(log);
                }
            }
        }
    </script>
</body>
</html>
